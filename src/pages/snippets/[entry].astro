---
import { loadSnippets, type SnippetEntry } from '@/api/content/snippets'
import { formatDate, unslash } from '@/api/utils'

import { withSeoOptions, Common } from '@/config'

import Snippet from '@/screens/snippets/Snippet.astro'
import Page from '@/layouts/Page.astro'

export interface Props {
  snippet: SnippetEntry
}

export async function getStaticPaths() {
  const snippetsRaw = await loadSnippets()

  return snippetsRaw.map((snippet) => ({
    params: { entry: snippet.slug },
    props: { snippet }
  }))
}

const { snippet } = Astro.props
const { title, description, createdAt, updatedAt } = snippet.frontmatter

const props = withSeoOptions({
  title: `${title} â€“ ${Common.title}`,
  description,
  canonical: unslash(Astro.url.href),
  openGraph: {
    basic: {
      title,
      type: 'article',
      url: unslash(Astro.url.href)
    },
    optional: {
      description
    },
    article: {
      authors: ['Vladislav Mamon'],
      publishedTime: formatDate(createdAt, 'yyyy-LL-dd'),
      ...updatedAt && {
        modifiedTime: formatDate(updatedAt, 'yyyy-LL-dd')
      }
    }
  }
})
---

<Page {...props}>
  <Snippet item={snippet} />
</Page>
