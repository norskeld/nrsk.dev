---
import { loadArticles, type ArticleEntry } from '@/api/content/articles'
import { resolveTagsStaticPaths } from '@/api/content/tags'
import { unslash } from '@/api/utils'

import { withSeoOptions, Common } from '@/config'

import ArticleList from '@/screens/blog/ArticleList.astro'
import PageHeader from '@/components/PageHeader.astro'
import Page from '@/layouts/Page.astro'

export interface Props {
  tag: string
  articles: Array<ArticleEntry>
}

export async function getStaticPaths() {
  const articles = await loadArticles()

  return resolveTagsStaticPaths(articles, ([tag, articles]) => ({
    params: { tag },
    props: { tag, articles }
  }))
}

const { tag, articles } = Astro.props

const title = `Articles tagged '${tag}' â€“ ${Common.title}`
const description = `Articles tagged '${tag}'.`

const props = withSeoOptions({
  title,
  description,
  canonical: unslash(Astro.url.href),
  openGraph: {
    basic: {
      title: `Articles tagged '${tag}'`,
      type: 'website',
      url: unslash(Astro.url.href)
    },
    optional: {
      description
    }
  }
})
---

<Page {...props}>
  <PageHeader title={`#${tag}`} />

  <ArticleList items={articles} />
</Page>
